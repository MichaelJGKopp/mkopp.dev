# üìÑ ADR 009: OpenAPI Code Generation for Type-Safe API Clients

## Status

**Accepted** (2025-12-04)

## Context

The Angular frontend needs to communicate with the Spring Boot backend via REST APIs. Key challenges include:

* Ensuring type safety between frontend and backend
* Maintaining consistency when API contracts change
* Avoiding manual TypeScript interface definitions
* Reducing bugs from API contract mismatches
* Automating client code updates when backend changes

The backend already exposes an OpenAPI 3.1 specification generated by Springdoc.

## Decision

We will use **OpenAPI Generator CLI** to automatically generate TypeScript API clients from the backend's OpenAPI contract.

Implementation:

* **Contract Location**: `api-contracts/backend/openapi.json` (generated by Springdoc)
* **Generator**: OpenAPI Generator CLI 2.25.2
* **Output**: `libs/api-clients/backend` (Nx library)
* **Configuration**: `openapitools.json` with generator settings
* **Generation**: Manual script execution during development
* **TypeScript Paths**: Configured in `tsconfig.base.json` as `@mkopp/api-clients/backend`
* **Integration**: Angular services inject generated service classes

**Generated Artifacts:**

* TypeScript interfaces for all request/response DTOs
* Service classes with typed methods for each API endpoint
* Configuration class for base URL and authentication
* Model classes (validation via Zod planned for future enhancement)

**Workflow:**

1. Backend exposes OpenAPI spec at `/v3/api-docs`
2. Export spec to `api-contracts/backend/openapi.json`
3. Run OpenAPI Generator CLI to generate TypeScript client
4. Generated code placed in `libs/api-clients/backend`
5. Frontend imports typed services via `@mkopp/api-clients/backend`

## Alternatives Considered

### Manual TypeScript Interfaces

* ‚úÖ Full control over code
* ‚úÖ No tooling dependencies
* ‚ùå High maintenance burden
* ‚ùå Prone to drift from backend contract
* ‚ùå Manual updates for every API change
* ‚ùå No runtime validation

### Swagger Codegen

* ‚úÖ Mature and widely used
* ‚úÖ Similar capabilities to OpenAPI Generator
* ‚ùå Less active development (OpenAPI Generator is a fork with more activity)
* ‚ùå Smaller community
* ‚ùå Fewer templates and customizations

### tRPC or GraphQL Code Generation

* ‚úÖ Type safety from schema
* ‚úÖ Excellent developer experience
* ‚ùå Requires adopting tRPC/GraphQL on backend
* ‚ùå Major architectural change
* ‚ùå Already invested in REST with Springdoc

### OpenAPI Generator CLI

* ‚úÖ Active development and large community
* ‚úÖ Supports OpenAPI 3.1 specification
* ‚úÖ Highly customizable with templates
* ‚úÖ Generates idiomatic TypeScript code
* ‚úÖ Works with existing REST backend
* ‚úÖ Integrated into Nx monorepo as library
* ‚ùå Requires manual script execution (not automated in build)
* ‚ùå Generated code can be verbose

## Consequences

### Positive

* **Type Safety**: Compile-time errors when frontend uses changed backend APIs
* **Single Source of Truth**: OpenAPI contract defines both backend and frontend types
* **Reduced Bugs**: Catch API mismatches before runtime
* **Faster Development**: No manual interface writing
* **Documentation**: Generated code includes JSDoc from OpenAPI descriptions
* **Monorepo Integration**: Generated library lives in `libs/` alongside other shared code

### Negative

* **Manual Regeneration**: Developers must remember to regenerate after backend changes
* **Code Review Noise**: Generated code changes can be large
* **Generated Code**: Can be verbose and less readable than hand-written code
* **Learning Curve**: Team needs to understand generation workflow

### Implementation Notes

**Current State:**

* OpenAPI Generator CLI configured in `openapitools.json`
* Generated clients in `libs/api-clients/backend`
* TypeScript path mapping for clean imports
* Used by BlogService, CommentsService, UserService, LikesService in frontend

**Future Improvements:**

* Automate generation in CI/CD pipeline
* Add npm script for easy regeneration
* Consider runtime validation with generated types
* Explore custom templates for cleaner generated code
* Document generation workflow in CONTRIBUTING.md

**Integration Example:**

```typescript
import { BlogService, BlogPostResponse } from '@mkopp/api-clients/backend';

@Component({...})
export class BlogComponent {
  private blogService = inject(BlogService);
  
  posts = signal<BlogPostResponse[]>([]);
  
  loadPosts() {
    this.blogService.getAllPosts().subscribe(page => {
      this.posts.set(page.content); // Fully typed!
    });
  }
}
```

## Related Documents

* [Design Document v0.4](../design.md)
* [OpenAPI Specification](../../api-contracts/backend/openapi.json)
* [OpenAPI Generator Documentation](https://openapi-generator.tech/)
* [Springdoc OpenAPI Documentation](https://springdoc.org/)
